
## TCP/IP栈参考模型
![[Pasted image 20260109150330.png]]

- **应用层**：  
    **定义网络应用的通信规则和数据格式，为应用程序提供直接的网络服务接口。**
    
- **传输层**：  
    **在源主机与目标主机的进程之间提供端到端的数据传输服务，决定可靠性与传输方式。**
    
- **网络层**：  
    **负责逻辑寻址与路由选择，实现跨网络的数据转发与主机到主机通信。**
    
- **网络接口层**：  
    **负责在本地物理网络中完成数据帧的封装、传输和差错检测。**

![[Pasted image 20260109150802.png]]
**TCP/IP栈的协议**

## 主机到网络层协议（链路层）

**以太网数据帧格式**

以太网用48位也就是6个字节表示MAC地址，地址后面是类型字段（2字节），例如0800表示帧的数据为IP数据，0806表示此帧为ARP请求。
![[Pasted image 20260109151833.png]]
**数据字段有效范围是46～1500**

这样MAC帧大小范围介于64与1518之间


## IP简介

IP是TCP/IP中最重要的协议，它为TCP、UDP、ICMP等协议提供传输的通路。IP层的主要目的是提供子网的互联网，形成较大的网络，是不同的子网之间能够传输数据。
## P 层的核心作用

### 1️⃣ 逻辑寻址（Logical Addressing）

- 使用 **IP 地址** 唯一标识网络中的主机/接口
    
- 与 MAC 地址解耦（IP 是逻辑的、可变的）
    

> 👉 解决“**你是谁，在网络中的位置是什么**”

---

### 2️⃣ 路由与转发（Routing & Forwarding）

- 根据目的 IP 选择下一跳
    
- 路由器逐跳转发数据包
    

> 👉 解决“**数据该走哪条路**”

---

### 3️⃣ 跨网络通信（Internetworking）

- 屏蔽不同物理网络的差异
    
- 实现不同子网、不同链路技术之间的互联
    

> 👉 解决“**不同网络之间如何互通**”

---

### 4️⃣ 尽力而为的数据传输（Best Effort）

- 不保证：
    
    - 到达
        
    - 顺序
        
    - 不重复
        
- 不做重传、不做流控
    

> 👉 可靠性由 **上层（TCP）** 负责

---

### 5️⃣ 分片与重组（Fragmentation & Reassembly）

- 当 IP 包大于链路 MTU 时：
    
    - 发送端或中间路由器进行分片（IPv4）
        
    - 接收端重组
        

> 👉 适配不同链路的最大传输能力


**IP协议头**
![[Pasted image 20260109152846.png]]
### 1️⃣ Version（版本）——4 bit

- **大小**：4 位
    
- **含义**：IP 协议版本
    
    - `4` → IPv4
        
    - `6` → IPv6
        

---

### 2️⃣ IHL（Internet Header Length）——4 bit

- **大小**：4 位
    
- **含义**：IP 头部长度
    
- **单位**：**4 字节**
    
- **取值**：
    
    - 最小：5 → 5 × 4 = **20 字节**
        
    - 最大：15 → 60 字节
        

> 👉 用来判断 IP 头后面数据从哪开始

---

### 3️⃣ Type of Service（TOS）/ DSCP + ECN ——8 bit

- **大小**：8 位
    
- **含义**：
    
    - 现代拆分为：
        
        - **DSCP（6 bit）**：服务质量/QoS
            
        - **ECN（2 bit）**：显式拥塞通知
            

---

### 4️⃣ Total Length（总长度）——16 bit

- **大小**：16 位（2 字节）
    
- **含义**：**整个 IP 包的长度**
    
- **单位**：字节
    
- **范围**：20 ~ 65535 字节
    

> 👉 包括 **IP 头 + 数据**

---

### 5️⃣ Identification（标识）——16 bit

- **大小**：16 位
    
- **含义**：用于 **IP 分片重组**
    
- 同一个原始 IP 包的所有分片：
    
    - Identification 值相同
        

---

### 6️⃣ Flags（标志位）——3 bit

- **大小**：3 位
    
- **含义**：
    
    - bit0：保留（必须为 0）
        
    - bit1：**DF（Don’t Fragment）** → 不允许分片
        
    - bit2：**MF（More Fragment）** → 后面还有分片
        

---

### 7️⃣ Fragment Offset（分片偏移）——13 bit

- **大小**：13 位
    
- **含义**：该分片在原始数据中的位置
    
- **单位**：**8 字节**
    

> 👉 Offset × 8 = 实际偏移字节数

---

### 8️⃣ Time To Live（TTL）——8 bit

- **大小**：8 位
    
- **含义**：生存时间（实际上是**跳数限制**）
    
- 每经过一个路由器：
    
    - TTL − 1
        
- TTL = 0 → 丢弃并返回 ICMP
    

---

### 9️⃣ Protocol（协议号）——8 bit

- **大小**：8 位
    
- **含义**：指明上层使用的协议
    
- 常见值：
    
    - `6` → TCP
        
    - `17` → UDP
        
    - `1` → ICMP
        
	- 2 ->IGMP
---

### 🔟 Header Checksum（头部校验和）——16 bit

- **大小**：16 位
    
- **含义**：只校验 **IP 头**
    
- 每一跳都会重新计算（TTL 会变化）
    
使用循环冗余校验生成，其作用是保证IP帧的完整性。

---

### 1️⃣1️⃣ Source IP Address ——32 bit

- **大小**：32 位（4 字节）
    
- **含义**：源主机 IP 地址
    

---

### 1️⃣2️⃣ Destination IP Address ——32 bit

- **大小**：32 位（4 字节）
    
- **含义**：目的主机 IP 地址
    

---

### 1️⃣3️⃣ Options（可选）——0 ~ 40 字节

- **大小**：可变
    
- **含义**：扩展功能（如时间戳、路由记录）
    
- **很少使用**，影响性能
    

---

### 1️⃣4️⃣ Padding（填充）

- **大小**：可变
    
- **含义**：填充到 4 字节对齐

 IPv4 头部大小总结

|项目|数值|
|---|---|
|最小 IP 头|**20 字节**|
|最大 IP 头|**60 字节**|
|常见 IP 头|**20 字节（无 Options）**|

