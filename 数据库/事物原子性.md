MySQL 事务的**原子性（Atomicity）**指：把一组 SQL 操作当作一个不可再分的整体，要么**全部成功提交**，要么在出错/回滚时**全部撤销**，不会出现“只做了一半”的永久结果。前提是使用支持事务的存储引擎（通常是 InnoDB）。

---

## 1) 原子性在 MySQL 中如何体现

你在一个事务里执行多条 `INSERT/UPDATE/DELETE`：

- 执行到一半出错（例如约束冲突、手动 `ROLLBACK`、连接中断等）
    
- 只要事务没有 `COMMIT`，这些修改都不会成为最终状态
    
- 执行 `ROLLBACK` 后，数据回到事务开始前的样子
    

示例（“转账”最经典）：

```SQL
START TRANSACTION;

UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;

-- 如果第二句失败（比如 id=2 不存在、触发约束等）
ROLLBACK;  -- 第一条也会被撤销
```


```SQL
-- 前置：t_ok 存在，t_no 不存在
DROP TABLE IF EXISTS t_ok;
DROP TABLE IF EXISTS t_no;
CREATE TABLE t_ok(id INT) ENGINE=InnoDB;

-- 原子性：列表中有一个不存在 -> 语句失败，且不删除任何表
DROP TABLE t_ok, t_no;

-- 验证：t_ok 仍然在
SHOW TABLES LIKE 't_ok';
```
---

## 2) InnoDB 通过什么机制保证原子性

核心是 **Undo Log（回滚日志）**：

- 每次修改数据前，InnoDB 会把“如何撤销这次修改”的信息写入 Undo Log
    
- 如果事务回滚，就根据 Undo Log 把数据恢复到修改前
    
- 如果事务提交，Undo Log 也不会立刻消失，还会被 MVCC 用来提供一致性读（之后才被清理）
    

> 简化理解：**Undo Log 负责“能撤回”**，因此支撑原子性。

---

## 3) 原子性 ≠ 一定能“回滚所有东西”

MySQL 里你要特别注意两点：

### A) DDL 常会隐式提交（原子性边界）

像 `CREATE TABLE / ALTER TABLE / DROP TABLE` 这类 DDL，在 MySQL 里通常会触发**隐式提交**（不同版本/语句细节可能不同，但这是常见规则）。因此很多情况下你不能指望 “DDL + DML 放同一事务里再回滚” 能完全回到原样。

### B) 非事务引擎不保证

如果表是 MyISAM 等非事务引擎，`ROLLBACK` 对它们的修改可能不起作用。

---

## 4) 你在考试/面试里可以这样一句话回答

“MySQL（InnoDB）事务的原子性是指：事务内的一组操作要么全部提交成功，要么在回滚时全部撤销；其实现依赖 InnoDB 的 Undo Log 来支持回滚与撤销，从而避免部分更新成为最终结果。”