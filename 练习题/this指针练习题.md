# ä¸€ã€`this` æŒ‡é’ˆä¸æˆå‘˜å‡½æ•°ï¼ˆ1â€“4ï¼‰

### 1ï¸âƒ£ `this` çš„æœ¬è´¨ï¼ˆç†è§£é¢˜ï¼‰

ä¸‹é¢æˆå‘˜å‡½æ•°ä¸­ï¼Œ`this` çš„ç±»å‹åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
```C++
class A {
public:
    void f();
    void g() const;
};
```

è¯·å†™å‡ºï¼š

- `f()` ä¸­ `this` çš„ç±»å‹
    
- `g()` ä¸­ `this` çš„ç±»å‹

**ç­”æ¡ˆï¼š**

- `void f();` ä¸­ï¼š`this` ç±»å‹æ˜¯ `A* const`
    
- `void g() const;` ä¸­ï¼š`this` ç±»å‹æ˜¯ `const A* const`
    

**æ˜“é”™ç‚¹ï¼š**

- å¾ˆå¤šäººåªå†™ `A*` / `const A*`ï¼Œä½†æ›´å‡†ç¡®æ˜¯â€œæŒ‡é’ˆæœ¬èº«æ˜¯ constâ€ï¼ˆ`this` ä¸èƒ½è¢«é‡æ–°èµ‹å€¼ï¼‰ã€‚

---

### 2ï¸âƒ£ `this` ç­‰ä»·å±•å¼€ï¼ˆç†è§£é¢˜ï¼‰

ç»™å®šä»£ç ï¼š

```C++
class Point {
public:
    void move(int dx) {
        x += dx;
    }
private:
    int x;
};

Point p;
p.move(5);
```

è¯·å†™å‡º**ç¼–è¯‘å™¨å†…éƒ¨ç­‰ä»·çš„å‡½æ•°è°ƒç”¨å½¢å¼**ï¼ˆä¸è¦æ±‚å®Œå…¨ç¬¦åˆè¯­æ³•ï¼Œåªéœ€ä½“ç° `this`ï¼‰ã€‚

**ç­”æ¡ˆï¼š**
```C++
Point::move(&p,5);
```
**æ˜“é”™ç‚¹ï¼š**

- è¿™åªæ˜¯â€œæ¦‚å¿µç­‰ä»·â€ã€‚çœŸå® ABI å¯èƒ½æ›´å¤æ‚ï¼Œä½†ç†è§£è¿™æ ·å°±å¤Ÿäº†ã€‚

---

### 3ï¸âƒ£ `this == &obj` å—ï¼Ÿï¼ˆåˆ¤æ–­é¢˜ï¼‰

åœ¨ä¸‹é¢ä»£ç ä¸­ï¼Œ`this == &a` æ˜¯å¦æ’æˆç«‹ï¼Ÿè¯´æ˜ç†ç”±ã€‚

```C++
class A {
public:
    void check() {
        // this == &a ?
    }
};

A a;
a.check();
```
**ç­”æ¡ˆï¼š**åœ¨è¿™æ®µä»£ç é‡Œ **æˆç«‹**ï¼ˆ`a.check()` çš„å½“å‰å¯¹è±¡å°±æ˜¯ `a`ï¼‰ã€‚

**æ˜“é”™ç‚¹ï¼š**

- åªå¯¹â€œä»¥å¯¹è±¡/å¼•ç”¨è°ƒç”¨â€æˆç«‹ï¼›å¦‚æœä½ å†™å‡º UB çš„è°ƒç”¨æ–¹å¼ï¼ˆè§ä¸‹ä¸€é¢˜ï¼‰ï¼Œå°±ä¸æˆç«‹ç”šè‡³ç‚¸ã€‚
---

### 4ï¸âƒ£ `this` èƒ½ä¸º `nullptr` å—ï¼Ÿï¼ˆæ€è€ƒé¢˜ï¼‰

æ˜¯å¦å¯èƒ½åœ¨æˆå‘˜å‡½æ•°ä¸­å‡ºç° `this == nullptr` çš„æƒ…å†µï¼Ÿ  
åœ¨**ä»€ä¹ˆæƒ…å†µä¸‹ä»£ç èƒ½ç¼–è¯‘ä½†è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ï¼ˆUBï¼‰**ï¼Ÿ
**ç­”æ¡ˆï¼š**

- æ ‡å‡†æ„ä¹‰ä¸Šï¼š**ä¸åº”è¯¥**ä¸º `nullptr`
    
- ä½†ä½ å¯ä»¥å†™å‡º**èƒ½ç¼–è¯‘**å´ **UB** çš„ä»£ç ï¼Œæ¯”å¦‚ï¼š
```C++
A *a=nullptr;
a.check();
```
**æ˜“é”™ç‚¹ï¼š**

- â€œèƒ½ç¼–è¯‘â€ â‰  â€œåˆæ³•â€ã€‚æˆå‘˜å‡½æ•°è°ƒç”¨è¯­æ³•ä¼šè®©ä½ è¯¯ä»¥ä¸ºæ²¡è§£å¼•ç”¨ã€‚
---

# äºŒã€`const` æˆå‘˜å‡½æ•°ï¼ˆ5â€“7ï¼‰

### 5ï¸âƒ£ `const` æˆå‘˜å‡½æ•°é™åˆ¶ï¼ˆç†è§£é¢˜ï¼‰

ä¸‹é¢å“ªäº›è¯­å¥åœ¨ `const` æˆå‘˜å‡½æ•°ä¸­æ˜¯**åˆæ³•çš„**ï¼Ÿå“ªäº›æ˜¯éæ³•çš„ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

```C++
class A {
public:
    int x;
    mutable int y;

    void f() const {
        x = 1;
        y = 2;
    }
};
```
**ç­”æ¡ˆï¼š**

- `x = 1;` âŒéæ³•ï¼ˆ`x` æ˜¯æ™®é€šæˆå‘˜ï¼Œ`this` æ˜¯ `const A*`ï¼‰
    
- `y = 2;` âœ…åˆæ³•ï¼ˆ`mutable` å…è®¸åœ¨ `const` æˆå‘˜å‡½æ•°ä¸­ä¿®æ”¹ï¼‰
    

**æ˜“é”™ç‚¹ï¼š**

- `mutable` å¸¸ç”¨äºç¼“å­˜ã€å»¶è¿Ÿè®¡ç®—ï¼Œä¸è¦æ»¥ç”¨ï¼ˆä¼šç ´åâ€œé€»è¾‘ constâ€ï¼‰ã€‚
---

### 6ï¸âƒ£ `const` å¯¹è±¡çš„è°ƒç”¨é™åˆ¶ï¼ˆåˆ¤æ–­é¢˜ï¼‰

åˆ¤æ–­ä¸‹åˆ—ä»£ç æ˜¯å¦èƒ½é€šè¿‡ç¼–è¯‘ï¼Œå¹¶è¯´æ˜åŸå› ï¼š

```C++
class A {
public:
    void f();
    void g() const;
};

const A a;
a.f();
a.g();
```
**ç­”æ¡ˆï¼š**

- `a.f();` âŒ ç¼–è¯‘å¤±è´¥ï¼ˆ`f()` ä¸æ˜¯ constï¼‰
    
- `a.g();` âœ… å¯ä»¥
    

**æ˜“é”™ç‚¹ï¼š**

- const å¯¹è±¡åªèƒ½è°ƒç”¨ const æˆå‘˜å‡½æ•°ï¼Œè¿™æ˜¯é¢è¯•å¿…é—®ã€‚
---

### 7ï¸âƒ£ æ¥å£è®¾è®¡é¢˜ï¼ˆç®€ç­”ï¼‰

ä¸ºä»€ä¹ˆ**getter**ï¼ˆå¦‚ `get_x()`ï¼‰é€šå¸¸è¦å£°æ˜ä¸º `const` æˆå‘˜å‡½æ•°ï¼Ÿ  
è¯·ç»™å‡º **ä¸¤ä¸ªç†ç”±**ã€‚
**æ ‡å‡†ç­”æ¡ˆï¼ˆç»™ä¸¤ä¸ªç†ç”±å³å¯ï¼‰ï¼š**

1. **å¯åœ¨ `const` å¯¹è±¡/å¼•ç”¨ä¸Šè°ƒç”¨**ï¼ˆæ¯”å¦‚ `const A&` å‚æ•°ï¼‰
    
2. **è¡¨è¾¾æ¥å£è¯­ä¹‰ï¼šåªè¯»ã€ä¸ä¿®æ”¹å¯¹è±¡çŠ¶æ€**ï¼ˆæ›´å®‰å…¨ã€æ›´æ˜“ç»´æŠ¤/æ¨ç†ï¼‰
    

**æ˜“é”™ç‚¹ï¼š**

- å¦‚æœå¿˜äº†åŠ  `const`ï¼Œä½ çš„ç±»ä¼šå¾ˆéš¾è¢« STL / ç®—æ³•æ­£ç¡®ä½¿ç”¨ï¼ˆæ¯”å¦‚å­˜åˆ° `const` å®¹å™¨è§†è§’é‡Œï¼‰ã€‚
---

# ä¸‰ã€`static` æˆå‘˜ï¼ˆ8â€“10ï¼‰

### 8ï¸âƒ£ é™æ€æˆå‘˜è®¿é—®è§„åˆ™ï¼ˆåˆ¤æ–­é¢˜ï¼‰

ä¸‹é¢ä»£ç ä¸­ï¼Œå“ªäº›è®¿é—®æ˜¯åˆæ³•çš„ï¼Ÿå“ªäº›ä¸åˆæ³•ï¼Ÿè¯´æ˜åŸå› ã€‚

```C++
class A {
public:
    static int s;
    int x;

    static void f() {
        s = 1;
        x = 2;
    }
};
```
**ç­”æ¡ˆï¼š**

- `s = 1;` âœ…åˆæ³•ï¼ˆé™æ€æˆå‘˜å±äºç±»ï¼‰
    
- `x = 2;` âŒéæ³•ï¼ˆé™æ€å‡½æ•°æ²¡æœ‰ `this`ï¼Œæ— æ³•è®¿é—®å¯¹è±¡æˆå‘˜ï¼‰
    

**æ˜“é”™ç‚¹ï¼š**

- é™æ€å‡½æ•°æƒ³è®¿é—® `x`ï¼Œå¿…é¡»**é€šè¿‡ä¸€ä¸ªå¯¹è±¡/æŒ‡é’ˆ/å¼•ç”¨å‚æ•°**ä¼ è¿›æ¥ã€‚
---

### 9ï¸âƒ£ é™æ€æˆå‘˜å˜é‡çš„å­˜å‚¨ï¼ˆç†è§£é¢˜ï¼‰

ä¸‹é¢ä»£ç ä¸­ï¼Œä¸€å…±å­˜åœ¨å‡ ä»½ `count`ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

```C++
class A {
public:
    static int count;
};

A a1, a2;
```
**ç­”æ¡ˆï¼š**åªæœ‰ **1 ä»½** `A::count`ï¼ˆå…¨å±€å”¯ä¸€ï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«ï¼‰

**æ˜“é”™ç‚¹ï¼š**

- `a1.count` è¿™ç§å†™æ³•è¯­æ³•å…è®¸ï¼Œä½†æœ¬è´¨è¿˜æ˜¯ `A::count`ã€‚
---

### ğŸ”Ÿ é™æ€æˆå‘˜ vs å…¨å±€å˜é‡ï¼ˆæ€è€ƒé¢˜ï¼‰

ä»**å°è£…æ€§ã€å‘½åç©ºé—´ã€å¯ç»´æŠ¤æ€§**è§’åº¦ï¼Œè¯´æ˜ä¸ºä»€ä¹ˆâ€œç±»å†… `static` æˆå‘˜å˜é‡â€é€šå¸¸ä¼˜äºå…¨å±€å˜é‡ã€‚
**å‚è€ƒç­”æ¡ˆï¼š**

- **å°è£…æ€§**ï¼šæ”¾åœ¨ç±»é‡Œï¼Œè®¿é—®è·¯å¾„æ¸…æ™°ï¼ˆ`A::count`ï¼‰ï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€å‘½åç©ºé—´
    
- **å¯ç»´æŠ¤æ€§**ï¼šå¯ä»¥é…åˆè®¿é—®æ§åˆ¶ï¼ˆprivate + getterï¼‰ã€æ›´æ˜“å®šä½ä¸ç®¡ç†
    
- **å‘½åå†²çªæ›´å°‘**ï¼šå…¨å±€å˜é‡å®¹æ˜“ä¸åˆ«çš„æ¨¡å—æ’å
    

**æ˜“é”™ç‚¹ï¼š**

- å…¨å±€å˜é‡åœ¨å¤§å‹é¡¹ç›®é‡Œæ˜¯â€œç»´æŠ¤ç¾éš¾â€ï¼Œç±»å†… static æ˜¯å¸¸è§æ›¿ä»£æ–¹æ¡ˆã€‚
---

# å››ã€æ™®é€šæˆå‘˜ vs é™æ€æˆå‘˜ï¼ˆ11â€“12ï¼‰

### 1ï¸âƒ£1ï¸âƒ£ å†…å­˜æ¨¡å‹ç†è§£ï¼ˆç†è§£é¢˜ï¼‰

ç»™å®šä»£ç ï¼š

```C++
class A {
public:
    int x;
    static int y;
};

A a1, a2;
```

è¯·å›ç­”ï¼š

1. `a1.x` å’Œ `a2.x` æ˜¯å¦æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Ÿ
    
2. `a1.y` å’Œ `a2.y` æ˜¯å¦æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Ÿ
    
**ç­”æ¡ˆï¼š**

1. `a1.x` å’Œ `a2.x`ï¼šâŒä¸å…±äº«ï¼ˆæ¯ä¸ªå¯¹è±¡ä¸€ä»½ï¼‰
    
2. `a1.y` å’Œ `a2.y`ï¼šâœ…å…±äº«ï¼ˆå…¨ç±»ä¸€ä»½ï¼‰
---

### 1ï¸âƒ£2ï¸âƒ£ å¯¹è±¡å¤§å°åˆ¤æ–­ï¼ˆæ€è€ƒé¢˜ï¼‰

å‡è®¾ `int` å  4 å­—èŠ‚ï¼Œä¸è€ƒè™‘å¯¹é½ï¼š

```C++
class A {
public:
    int x;
    static int y;
};
```

`sizeof(A)` æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
**ç­”æ¡ˆï¼š**`sizeof(A) == sizeof(int)`ï¼Œä¸€èˆ¬æ˜¯ **4**ï¼ˆå¿½ç•¥å¯¹é½æ—¶ä¹Ÿæ˜¯ 4ï¼‰ã€‚

**åŸå› ï¼š**

- `static` æˆå‘˜ä¸åœ¨å¯¹è±¡å†…éƒ¨ï¼Œä¸è®¡å…¥å¯¹è±¡å¤§å°ã€‚
    

**æ˜“é”™ç‚¹ï¼š**

- å¾ˆå¤šäººè¯¯ä»¥ä¸º static ä¹Ÿå å¯¹è±¡å¤§å°ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚
---

# äº”ã€ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼ˆ13â€“15ï¼Œå« 5 é“ç¼–ç¨‹é¢˜ï¼‰

---

## ğŸ§  ç†è§£é¢˜

### 1ï¸âƒ£3ï¸âƒ£ é»˜è®¤ç”Ÿæˆè§„åˆ™ï¼ˆåˆ¤æ–­é¢˜ï¼‰

åœ¨ä¸‹é¢ç±»ä¸­ï¼Œç¼–è¯‘å™¨ä¼š**è‡ªåŠ¨ç”Ÿæˆå“ªäº›ç‰¹æ®Šæˆå‘˜å‡½æ•°**ï¼Ÿ

```C++
class A {
public:
    A(int x);
private:
    int x;
};
```

è¯·åˆ¤æ–­æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆï¼š

- é»˜è®¤æ„é€ 
    
- æ‹·è´æ„é€ 
    
- æ‹·è´èµ‹å€¼
    
- ç§»åŠ¨æ„é€ 
    
- ææ„å‡½æ•°
    
**ç­”æ¡ˆï¼š**

- é»˜è®¤æ„é€  `A()`ï¼šâŒä¸ä¼šç”Ÿæˆï¼ˆå› ä¸ºä½ å£°æ˜äº†å¸¦å‚æ„é€ ï¼‰
    
- æ‹·è´æ„é€ ï¼šâœ…ä¼šç”Ÿæˆ
    
- æ‹·è´èµ‹å€¼ï¼šâœ…ä¼šç”Ÿæˆ
    
- ç§»åŠ¨æ„é€  / ç§»åŠ¨èµ‹å€¼ï¼šâœ…**å¯èƒ½**ç”Ÿæˆï¼ˆC++11 èµ·ï¼Œä½†å—è§„åˆ™å½±å“ï¼›åªå« int çš„æƒ…å†µä¸‹é€šå¸¸å¯ä»¥ï¼‰
    
- ææ„ï¼šâœ…ä¼šç”Ÿæˆ
    

**æ˜“é”™ç‚¹ï¼š**

- â€œå†™äº†ä»»æ„æ„é€ å‡½æ•° â‡’ é»˜è®¤æ„é€ ä¸å†è‡ªåŠ¨ç”Ÿæˆâ€ è¿™ä¸ªè¦è®°ç‰¢ã€‚
    
- move çš„â€œæ˜¯å¦ç”Ÿæˆâ€ç»†èŠ‚å¾ˆå¤šï¼Œä½†ä½ å½“å‰é˜¶æ®µè®°ä½â€œé€šå¸¸å¯ç”Ÿæˆã€ä½†æœ‰æ¡ä»¶â€å°±è¡Œã€‚
---

## ğŸ’» ç¼–ç¨‹é¢˜ï¼ˆé‡ç‚¹ï¼‰


---

### 1ï¸âƒ£6ï¸âƒ£ï¼ˆç¼–ç¨‹é¢˜ 3ï¼‰é™æ€æˆå‘˜è®¡æ•°

å®ç°ä¸€ä¸ªç±» `ObjectCounter`ï¼š

- æ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè®¡æ•° +1
    
- æ¯ææ„ä¸€ä¸ªå¯¹è±¡ï¼Œè®¡æ•° -1
    
- æä¾› `static int get_count()`
    
```C++
class ObjectCounter{
	ObjectCounter(){count++}
	~ObjectCounter(){count--}
	ObjectCounter(const ObjectCounter&) {count++}
	ObjectCounter& operator=(const ObjectCounter&)=default;
	static int get(){
		return count;
	}

private:
 static int count ;
};
int ObjectCounter::count=0;
```
**staticæˆå‘˜å‡½æ•°åªèƒ½è®¿é—®staticæ•°æ®æˆå‘˜ï¼Œéstaticæˆå‘˜å‡½æ•°èƒ½è®¿é—®staticæ•°æ®æˆå‘˜,æƒ³è®¿é—®éœ€è¦ä¼ this**
```C++
class A {
public:
    int x;

    static void f(A* self) {
        self->x = 10;   // âœ… å®Œå…¨åˆæ³•
    }
};

int main() {
    A a;
    A::f(&a);
}
```

---

### 1ï¸âƒ£8ï¸âƒ£ï¼ˆç¼–ç¨‹é¢˜ 5ï¼‰`this` è¿”å›è‡ªèº«ï¼ˆé“¾å¼è°ƒç”¨ï¼‰

å®ç°ä¸€ä¸ªç±» `Adder`ï¼š

```C++
Adder a;
a.add(1).add(2).add(3);
```

è¦æ±‚ï¼š

- ä½¿ç”¨ `this`
    
- è¿”å›ç±»å‹æ­£ç¡®
    
```C++
class Adder {
public:
    Adder& add(int x) {
        sum_ += x;
        return *this; // æˆ– return *this;
    }

    int value() const { return sum_; }

private:
    int sum_ = 0;
};
```
---

## ğŸ¯ å»ºè®®åšé¢˜é¡ºåº

1 â†’ 2 â†’ 5 â†’ 6 â†’ 8 â†’ 11 â†’ 14 â†’ 15 â†’ 17  
ï¼ˆéå¸¸è´´åˆä½ å½“å‰çš„å­¦ä¹ æ›²çº¿ï¼‰